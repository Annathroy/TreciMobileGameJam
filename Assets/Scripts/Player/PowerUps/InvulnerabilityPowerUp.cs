using UnityEngine;

public class InvulnerabilityPowerUp : PowerUp
{
    private PlayerHealth health;

    protected override void OnActivate()
    {
        EnsureRefs();
        if (!health) return;

        // start (or restart) short-term invulnerability for `duration` seconds
        health.GrantInvulnerability(duration);
    }

    protected override void OnStack(int newCount)
    {
        // We use refresh-on-pickup behavior, but if stacking is enabled,
        // just refresh the invulnerability again (no additive effect needed).
        if (!health) EnsureRefs();
        if (!health) return;
        health.GrantInvulnerability(duration);
    }

    protected override void OnUnstack(int newCount)
    {
        // No-op: PlayerHealth stops invulnerability itself at the end of its timer.
    }

    protected override void OnDeactivate()
    {
        // No hard disable here: let PlayerHealth’s timer end naturally.
        // (Prevents interrupting other invuln sources like post-hit i-frames.)
    }

    private void EnsureRefs()
    {
        if (health) return;
        if (!player) return;
        health = player.GetComponent<PlayerHealth>() ?? player.GetComponentInChildren<PlayerHealth>(true);
        if (!health) Debug.LogError("[InvulnerabilityPowerUp] PlayerHealth not found on player.");
    }
}

